sm=first(fx_type)))$random)[1]),
ci.lb=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[3]),
ci.ub=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[4]),
I2=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))[['I2']]))))
library(dplyr)
## CATEGORICAL EFFECT TYPE META-ANALYSIS
cat_ma=df_nonmd%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[1]),
ci.lb=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[3]),
ci.ub=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[4]),
I2=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))[['I2']]))))
View(cat_ma)
View(ooo)
# FOR BINARY OUTCOMES
ooo=summary(metabin(event.surg,all.surg, event.control,all.control,data=temp, sm='RR', random=TRUE, method='MH'))
View(ooo)
x=(metabin(event.surg,all.surg, event.control,all.control,data=temp, sm='RR', random=TRUE, method='MH', method.bias = 'Egger'))
x
View(x)
sm=first(fx_type)))[['I2']])))
## CONTINUOUS EFFECT TYPE META-ANALYSIS
cont_ma=df_md%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK",
)
)$random)[1]),
ci.lb=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[3]),
ci.ub=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[4]),
I2=exp(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK")))[['I2']])))
# get i2 median and IQR
median(cont_ma$I2)
View(cont_ma)
## CATEGORICAL EFFECT TYPE META-ANALYSIS
cat_ma=df_nonmd%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[1]),
ci.lb=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[3]),
ci.ub=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[4]),
I2=(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))[['I2']]))))
View(cat_ma)
## CONTINUOUS EFFECT TYPE META-ANALYSIS
cont_ma=df_md%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK",
)
)$random)[1]),
ci.lb=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[3]),
ci.ub=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[4]),
I2=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK")))[['I2']])))
re_ma=rbind(cat_ma,cont_ma)
# get i2 median and IQR
median(cont$I2)
# get i2 median and IQR
median(re_ma$I2)
re_ma
# get i2 median and IQR
re_ma%>%filter(I2==NA)
# get i2 median and IQR
re_ma%>%filter(I2!='NA')
# get i2 median and IQR
re_ma%>%filter(I2!='NA')%>%median()
# get i2 median and IQR
re_ma%>%filter(I2!='NA')%>%median(I2)
# get i2 median and IQR
re_ma%>%filter(I2!='NA')%>%median(as.numeric(I2))
# get i2 median and IQR
i2_rema=re_ma%>%filter(I2!='NA')
median(i2_rema$I2)
iqr(i2_rema$I2)
IQR(i2_rema$I2)
View(re_ma)
# FOR BINARY OUTCOMES
summary(metabin(event.surg,all.surg, event.control,all.control,data=temp, sm='RR', random=TRUE, method='MH'))
# Excess significance
cat_es=dat_cat%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
TESS_p=(unlist(tes(yi, vi, test="chi2")$pval)[1])))
cont_es=dat_cont%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
TESS_p=(unlist(tes(yi, vi, test="chi2")$pval)[1])))
# Excess significance
cat_es=dat_cat%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
TESS_p=(unlist(tes(yi, vi, test="chi2")$pval)[1])))
cont_es=dat_cont%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
TESS_p=(unlist(tes(yi, vi, test="chi2")$pval)[1])))
rbind(cat_es, cont_es)
es=rbind(cat_es, cont_es)
es=rbind(cat_es, cont_es)%>%select(TESS_p)%>%count(TESS_p<0.05)
es=rbind(cat_es, cont_es)%>%select(TESS_p)#%>%count(TESS_p<0.05)
es
es=rbind(cat_es, cont_es)%>%select(TESS_p)%>%count(TESS_p<0.05)
es=rbind(cat_es, cont_es)%>%select(TESS_p)%>%filter(TESS_p<0.05)
cat_egg=dat_cat%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
EGGer=(unlist(regtest(yi, vi, model="rma")$pval)[1])))
rlang::last_trace()
rlang::last_trace(drop = FALSE)
dat_cat
cat_egg=dat_cat%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
EGGer=((regtest(yi, vi, model="rma")$pval)[1])))
dat_cat
egg_prep_cat=as.data.frame(dat_cat%>%count('INFO')%>%filter(freq>9))
egg_prep_cont=as.data.frame(dat_cont%>%count('INFO')%>%filter(freq>9))
egg_cat <- filter(dat_cat, dat_cat$INFO %in% egg_prep_cat$INFO)
cat_egg=egg_cat%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
EGGer=((regtest(yi, vi, model="rma")$pval)[1])))
# SOME REVIEWS NEEDED TO BE RE-ANALYZED (USING THE REVIEWS' ORIGINAL METHODS)
# TO GET THE SUMMARY EFFECT FOR THE INTERVENTION AS THE SUMMARY EFFECT OF THE
# PRIMARY OUTCOMES WASN'T PRESENTED
# Their CDSR-IDs are CD001802.PUB3, CD001081.PUB4, CD012602.PUB2, CD009526.PUB2
## Example of how this was performed:
temp=df_nonmd[df_nonmd['X.source..id']=='CD012602.PUB2',]
temp=df_nonmd%>%filter(X.source..id=='CD012602.PUB2')
temp=temp[temp['Outcome']=='Complete miscarriage\n',]
temp=temp[temp['medical_arm']=='Misoprostol and mifepristone',]
# FOR BINARY OUTCOMES
summary(metabin(event.surg,all.surg, event.control,all.control,data=temp, sm='RR', random=TRUE, method='MH'))$random
## CONTINUOUS EFFECT TYPE META-ANALYSIS
cont_ma=df_md%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK",
)
)$random)[1]),
ci.lb=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[3]),
ci.ub=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[4]),
p_val=summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random['p'],
I2=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK")))[['I2']])))
## CONTINUOUS EFFECT TYPE META-ANALYSIS
cont_ma=df_md%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK",
)
)$random)[1]),
ci.lb=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[3]),
ci.ub=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random)[4]),
p_val=summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK"))$random['p'],
I2=(unlist(summary(metacont(n.e=all.surg,
mean.e=mean.surg,
sd.e=SD.surg,
n.c=all.control,
mean.c=mean.control,
sd.c=SD.control,
sm=first(fx_type),
method.random.ci = "HK")))[['I2']])))
## CATEGORICAL EFFECT TYPE META-ANALYSIS
cat_ma=df_nonmd%>%
group_split(INFO=factor(INFO))%>%
map_dfr(~.x%>%summarise(INFO=first(INFO),
title=first(title),
surgical_arm=first(surgical_arm),
medical_arm=first(medical_arm),
Outcome=first(Outcome),
fx_type=first(fx_type),
effect=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[1]),
ci.lb=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[3]),
ci.ub=exp(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random)[4]),
p_val=summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))$random['p'],
I2=(unlist(summary(metabin(event.surg,
all.surg,
event.control,
all.control,
method='MH',
method.random.ci = "HK",
sm=first(fx_type)))[['I2']]))))
re_ma=rbind(cat_ma,cont_ma)
re_ma%>%count(p_val<0.05)
re_ma%>%filter(p_val<0.05)%>%nrow()/nrow(re_ma)
re_ma%>%filter(p_val<0.05)%>%nrow()
0.05*103
((38-5.15)^2)/(5.15+(38-5.15)^2)/(103-5.15)
# 1-beta
((38-50)^2)/(5.15+(38-50)^2)/(103-50)
# 1-beta
((38-5.15)^2)/(5.15+(38-5.15)^2)/(103-5.15)
re_ma%>%filter(p_val<0.05)%>%nrow()
0.38*103
38/103
0.5*103
# 1-beta
((38-51.5)^2)/(5.15+(38-51.5)^2)/(103-51.5)
# 1-beta
((38-51.5)^2)/51.5+(((38-51.5)^2)/(103-51.5))
# 1-beta
((38-5.15)^2)/5.15+(((38-5.15)^2)/(103-5.15))
# 1-beta
E=1-beta*103
O=38
# 1-beta
beta=0.5
E=1-beta*103
O=38
n=103
(O-E)^2/E+(O-E)^2/(n-E)
((O-E)^2/E)+((O-E)^2/(n-E))
(((O-E)^2)/E)+(((O-E)^2)/(n-E))
(((O-E)^2)/E)+(((O-E)^2)/(n-E))
cat_egg
cat_egg%>%filter(EGGer<0.05)
tes(y,vi,test='chi2',dat_cat)
tes(y,vi,test='chi2',data=dat_cat)
# Get the yi and vi columns for smooth assessment of excess significance and egger
dat_cat=escalc(measure="RR", ai=event.surg, n1i=all.surg, ci=event.control, n2i=all.control, data=df_nonmd)
dat_cont=escalc(measure="SMD", m1i=mean.surg, sd1i=SD.surg ,n1i=all.surg, m2i=mean.control,sd2i=SD.control, n2i=all.control, data=df_md)
tes(y,vi,test='chi2',data=dat_cat)
dat_cat%>%tes(y, vi, test='chi2')
tes?
?tes
dat_cat%>%tes(y=y, vi=vi, test='chi2')
tes(y=y, vi=vi, test='chi2', data=dat_cat)
tes(y=y, vi=vi, data=dat_cat,test='chi2')
tes(yi, vi, data=dat_cat,test='chi2')
tes(yi, vi, data=df,test='chi2')
tes(yi, vi, data=dat_cat,test='chi2')
tes(yi, vi, data=dat_cont,test='chi2')
rbind(dat_cat,dat_cont)
xx=rbind(dat_cat,dat_cont)
tes(yi, vi, data=xx,test='chi2')
View(df)
unique(paste0(df$study, df$year.of.study))
length(unique(paste0(df$study, df$year.of.study)))
length(unique(paste0(df$study, df$year.of.study,df$Outcome,df$surgical_arm,df$medical_arm)))
